<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>NOVA</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
        .product-detail {
            max-width: 1200px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
          }

          .product-detail img {
            width: 400px;
            max-width: 100%;
            border-radius: 8px;
            object-fit: cover;
          }

          .product-info {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 15px;
          }

          .product-info h1 {
            font-size: 28px;
            margin-bottom: 10px;
          }

          .product-info .price {
            font-size: 22px;
            color: black;
            font-weight: bold;
          }

          .product-info .desc {
            font-size: 16px;
            color: #555;
            line-height: 1.5;
          }

          .option-select label {
            font-weight: bold;
            display: block;
            margin: 10px 0 5px;
          }

          .option-select select {
            padding: 8px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
          }

          .total,
          .cart-btn {
            margin-bottom: 10px;
            display: block;
          }

          .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
          }

          .quantity-control button {
            width: 30px;
            height: 30px;
            font-size: 18px;
            background-color: #eee;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          }

          .total {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin: 10px 0;
          }

          .cart-btn {
            background-color: black;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
          }

          .tabs {
              position: sticky;
              top: 0;
              z-index: 999;
              background: #fff;
              display: flex;
              justify-content: center;
              border-bottom: 1px solid #ddd;
              padding: 10px 0;
              margin-bottom: 20px;
            }

            .tabs a {
              padding: 10px 20px;
              text-decoration: none;
              color: #333;
              font-weight: bold;
            }

            .tabs a:hover {
              color: #d32f2f;
            }

            .product-section {
              padding: 40px 10%;
              scroll-margin-top: 70px;
              border-bottom: 1px solid #eee;
            }

            .product-section:last-of-type {
              border-bottom: none;
            }

            @media (max-width: 768px) {
            .product-detail {
              flex-direction: column;
              align-items: center;
            }

            .product-info {
              max-width: 100%;
            }
        }
    </style>
</head>
<body>

<!-- 헤더 -->
<div th:replace="~{common/header :: header}"></div>

<!-- 상품 상세 카드 -->
<div class="product-detail">
    <img th:src="${product.imageUrl}" alt="상품 이미지" />
    <div class="product-info">
        <h1 th:text="${product.name}">상품명</h1>
        <div class="price" th:text="${#numbers.formatInteger(product.price.intValue(), 3, 'COMMA')} + '원'">가격</div>
        <div class="desc">
            <p th:text="${product.description}">상품 설명</p>
        </div>
        <div class="option-select">
            <label>색상:
                <select id="color">
                    <option value="">[필수] 선택</option>
                    <option value="블랙">블랙</option>
                    <option value="화이트">화이트</option>
                </select>
            </label>
        </div>
        <div class="option-select">
            <label>사이즈:
                <select id="size">
                    <option value="">[필수] 선택</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                </select>
            </label>
        </div>

        <div class="quantity-control">
            <button id="minus">-</button>
            <span id="quantity">1</span>
            <button id="plus">+</button>
        </div>

        <div class="total">TOTAL: <span id="totalPrice">0원</span></div>
        <button id="addToCart" class="cart-btn">장바구니에 담기</button>
    </div>
</div>

<!-- 탭 -->
<div class="tabs">
    <a href="#info">상품 정보</a>
    <a href="#review">상품 후기</a>
    <a href="#qna">상품 문의</a>
    <a href="#delivery">배송/교환/환불</a>
</div>

<!-- 콘텐츠 -->
<div id="info" class="product-section">
    <h2>상품 정보</h2>
    <p th:text="${product.description}">여기에 상세 상품 정보가 들어갑니다.</p>
</div>
<div id="review" class="product-section">
    <h2>상품 후기</h2>
    <p>후기가 여기에 표시됩니다.</p>
</div>
<div id="qna" class="product-section">
    <h2>상품 문의</h2>
    <p>문의 내용을 여기에 작성하거나 표시합니다.</p>
</div>
<div id="delivery" class="product-section">
    <h2>배송/교환/환불 안내</h2>
    <p>배송/교환/환불 정책이 여기에 들어갑니다.</p>
</div>

<!-- 푸터 -->
<div th:replace="~{common/footer :: footer}"></div>

<!-- JS -->
<script th:inline="javascript">
    const price = parseInt([[${product.price}]]);
    let quantity = 1;

    function updateTotal() {
      document.getElementById('quantity').innerText = quantity;
      document.getElementById('totalPrice').innerText = (quantity * price).toLocaleString() + '원';
    }

    document.getElementById('plus').addEventListener('click', () => {
      quantity++;
      updateTotal();
    });

    document.getElementById('minus').addEventListener('click', () => {
      if (quantity > 1) quantity--;
      updateTotal();
    });

    updateTotal();

    document.getElementById('addToCart').addEventListener('click', async () => {
      const selectedColor = document.getElementById('color').value;
      const selectedSize = document.getElementById('size').value;

      if (!selectedColor || !selectedSize) {
        alert("색상과 사이즈를 선택해주세요!");
        return;
      }

      try {
        const res = await fetch('/api/cart/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            menuId: [[${product.id}]],
            quantity: quantity
          })
        });

        if (res.ok) {
          alert("장바구니에 담겼습니다! 🛒");
        } else {
          const result = await res.text();
          alert("실패: " + result);
        }
      } catch (err) {
        alert("에러 발생!");
        console.error(err);
      }
    });
</script>

</body>
</html>

