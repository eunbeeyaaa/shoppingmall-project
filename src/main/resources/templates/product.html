<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>NOVA</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
        .product-detail {
            max-width: 1200px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
          }

          .product-detail img {
            width: 400px;
            max-width: 100%;
            border-radius: 8px;
            object-fit: cover;
          }

          .product-info {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 15px;
          }

          .product-info h1 {
            font-size: 28px;
            margin-bottom: 10px;
          }

          .product-info .price {
            font-size: 22px;
            color: black;
            font-weight: bold;
          }

          .product-info .desc {
            font-size: 16px;
            color: #555;
            line-height: 1.5;
          }

          .option-select label {
            font-weight: bold;
            display: block;
            margin: 10px 0 5px;
          }

          .option-select select {
            padding: 8px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
          }

          .total,
          .cart-btn {
            margin-bottom: 10px;
            display: block;
          }

          .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
          }

          .quantity-control button {
            width: 30px;
            height: 30px;
            font-size: 18px;
            background-color: #eee;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          }

          .total {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin: 10px 0;
          }

          .cart-btn {
            background-color: black;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
          }

          .tabs {
              position: sticky;
              top: 0;
              z-index: 999;
              background: #fff;
              display: flex;
              justify-content: center;
              border-bottom: 1px solid #ddd;
              padding: 10px 0;
              margin-bottom: 20px;
            }

            .tabs a {
              padding: 10px 20px;
              text-decoration: none;
              color: #333;
              font-weight: bold;
            }

            .tabs a:hover {
              color: rgb(153, 153, 153);
            }

            .product-section {
              /*padding: 40px 10%;*/
              scroll-margin-top: 70px;
              border-bottom: 1px solid #eee;
            }

            .product-section:last-of-type {
              border-bottom: none;
            }

            /* ë¦¬ë·° í•„í„° ìŠ¤íƒ€ì¼ */
            .review-filter {
              background-color: #f9f9f9;
              padding: 20px;
              border-radius: 8px;
              margin-bottom: 30px;
            }

            .filter-row {
              display: flex;
              align-items: center;
              gap: 20px;
              flex-wrap: wrap;
            }

            .filter-item {
              display: flex;
              align-items: center;
              gap: 8px;
            }

            .filter-item label {
              font-weight: bold;
              white-space: nowrap;
            }

            .filter-item select {
              padding: 5px 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              background-color: white;
            }

            .filter-item input {
              width: 60px;
              padding: 5px 8px;
              border: 1px solid #ddd;
              border-radius: 4px;
              text-align: center;
            }

            .search-btn {
              background-color: #333;
              color: white;
              border: none;
              padding: 8px 16px;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            }

            .search-btn:hover {
              background-color: #555;
            }

            /* ë¦¬ë·° ëª©ë¡ ìŠ¤íƒ€ì¼ */
            .review-list {
              display: flex;
              flex-direction: column;
              gap: 20px;
            }

            .review-item {
              padding: 20px;
              border: 1px solid #eee;
              border-radius: 8px;
              background-color: #fafafa;
            }

            .review-header {
              margin-bottom: 10px;
            }

            .reviewer-info {
              color: #666;
              font-size: 14px;
            }

            .review-content {
              line-height: 1.5;
              color: #333;
            }

            @media (max-width: 768px) {
            .product-detail {
              flex-direction: column;
              align-items: center;
            }

            .product-info {
              max-width: 100%;
            }

            .filter-row {
              flex-direction: column;
              align-items: stretch;
            }

            .filter-item {
              justify-content: space-between;
            }



    </style>
</head>
<body>

<!-- í—¤ë” -->
<div th:replace="~{common/header :: header}"></div>

<!-- ìƒí’ˆ ìƒì„¸ ì¹´ë“œ -->
<div class="product-detail">
    <img th:src="${product.imageUrl}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />
    <div class="product-info">
        <h1 th:text="${product.name}">ìƒí’ˆëª…</h1>
        <div class="price" th:text="${#numbers.formatInteger(product.price.intValue(), 3, 'COMMA')} + 'ì›'">ê°€ê²©</div>
        <div class="desc">
            <p th:text="${product.description}">ìƒí’ˆ ì„¤ëª…</p>
        </div>
        <div class="option-select">
            <label>ìƒ‰ìƒ:
                <select id="color">
                    <option value="">[í•„ìˆ˜] ì„ íƒ</option>
                    <option value="ë¸”ë™">ë¸”ë™</option>
                    <option value="í™”ì´íŠ¸">í™”ì´íŠ¸</option>
                </select>
            </label>
        </div>
        <div class="option-select">
            <label>ì‚¬ì´ì¦ˆ:
                <select id="size">
                    <option value="">[í•„ìˆ˜] ì„ íƒ</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                </select>
            </label>
        </div>

        <div class="quantity-control">
            <button id="minus">-</button>
            <span id="quantity">1</span>
            <button id="plus">+</button>
        </div>

        <div class="total">TOTAL: <span id="totalPrice">0ì›</span></div>
        <button id="addToCart" class="cart-btn">ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°</button>
    </div>
</div>

<!-- íƒ­ -->
<div class="tabs">
    <a href="#info">ìƒí’ˆ ì •ë³´</a>
    <a href="#review">ìƒí’ˆ í›„ê¸°</a>
    <a href="#qna">ìƒí’ˆ ë¬¸ì˜</a>
    <a href="#delivery">ë°°ì†¡/êµí™˜/í™˜ë¶ˆ</a>
</div>

<!-- ì •ë³´ -->
<div id="info" class="product-section">
    <h2>ìƒí’ˆ ì •ë³´</h2>
    <p th:text="${product.description}">ìƒì„¸ ì„¤ëª…</p>
</div>

<!-- í›„ê¸° (DB ì¡°íšŒ) -->
<div id="review" class="product-section">
    <h2>ìƒí’ˆ í›„ê¸°</h2>
    <div id="reviewList" class="review-list">
        <div th:each="review : ${reviews}" class="review-item" th:data-size="${review.size}"
             th:data-gender="${review.gender}" th:data-height="${review.height}" th:data-weight="${review.weight}">
            <div class="review-header">
                <span class="reviewer-info" th:text="${review.memberName + ' ' + review.createdAt + ' ' + review.size + ' ' + review.gender + ' ' + review.height + 'cm ' + review.weight + 'kg'}">ì‘ì„±ìì •ë³´</span>
            </div>
            <div class="review-content" th:text="${review.content}">ë¦¬ë·°ë‚´ìš©</div>
        </div>
    </div>
</div>

<!-- ë¬¸ì˜ (DB ì¡°íšŒ) -->
<div id="qna" class="product-section">
    <h2>ìƒí’ˆ ë¬¸ì˜</h2>
    <div class="qna-list">
        <div th:each="qna : ${qnas}" class="qna-item">
            <div class="qna-header">
                <span class="qna-author" th:text="${qna.memberName}">ë‹‰ë„¤ì„</span>
                <span class="qna-date" th:text="${qna.createdAt}">2025.05.02</span>
                <span class="qna-lock" th:if="${qna.isLocked}">ğŸ”’</span>
            </div>
            <div class="qna-content" th:text="${qna.isLocked ? 'ê´€ë¦¬ìë§Œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì‘ì„±ê¸€ì…ë‹ˆë‹¤.' : qna.content}"></div>
        </div>
    </div>
</div>

<div id="delivery" class="product-section">
    <h2>ë°°ì†¡/êµí™˜/í™˜ë¶ˆ ì•ˆë‚´</h2>
    <h4>DELIVERY</h4>
    <p>ê²°ì œì¼ ì´í›„ 2~3ì¼ ì´ë‚´ ë°œì†¡ (ì£¼ë§, ê³µíœ´ì¼ ì œì™¸)</p>
    <h4>EXCHANGE & REFUND</h4>
    <p>7ì¼ ì´ë‚´ë§Œ êµí™˜/í™˜ë¶ˆ ê°€ëŠ¥ (ìì„¸í•œ ë‚´ìš©ì€ ì •ì±… ì°¸ì¡°)</p>
</div>

<!-- í‘¸í„° -->
<div th:replace="~{common/footer :: footer}"></div>

<script src="/js/header.js" defer></script>
<script th:inline="javascript">
    const price = parseInt([[${product.price}]]);
    let quantity = 1;

    function updateTotal() {
      document.getElementById('quantity').innerText = quantity;
      document.getElementById('totalPrice').innerText = (quantity * price).toLocaleString() + 'ì›';
    }

    document.getElementById('plus').addEventListener('click', () => { quantity++; updateTotal(); });
    document.getElementById('minus').addEventListener('click', () => { if(quantity>1) quantity--; updateTotal(); });
    updateTotal();

    document.getElementById('addToCart').addEventListener('click', async () => {
      const color = document.getElementById('color').value;
      const size = document.getElementById('size').value;
      if (!color || !size) { alert("ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ì„ íƒ!"); return; }
      await fetch('/api/cart/add', {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: 'include',
        body: JSON.stringify({ menuId: [[${product.id}]], quantity, color, size })
      }).then(r => { if(r.ok) alert("ì¥ë°”êµ¬ë‹ˆ ë‹´ê¹€!"); else alert("ì‹¤íŒ¨!"); });
    });
</script>
</body>
</html>
